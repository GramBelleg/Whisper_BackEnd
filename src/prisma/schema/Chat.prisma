enum ChatType {
  DM
  GROUP
  CHANNEL
}

model Chat {
  id            Int               @id @default(autoincrement())
  type          ChatType
  messages      Message[]
  participants  ChatParticipant[]
  group         Group?
  channel       Channel?
}

model Group {
  chatId  Int    @id
  name    String
  picture String?
  maxSize Int    @default(100)
  privacy String @default("Private")
  chat    Chat   @relation(fields: [chatId], references: [id])
}

model Channel {
  chatId     Int    @id
  privacy    String
  inviteLink String
  chat       Chat   @relation(fields: [chatId], references: [id])

  participants ChannelParticipant[]
}

model ChatParticipant {
  id                    Int               @id @default(autoincrement())
  userId                Int
  chatId                Int
  isArchived            Boolean           @default(false)
  unreadMessageCount    Int               @default(0)
  lastMessageId         Int?             
  isContact             Boolean           @default(false)
  isMuted               Boolean           @default(false)
  draftContent          String            @default("")
  draftTime             DateTime?
  draftParentMessageId  Int?
  draftParentContent    String?
  draftParentMedia      String?
  draftParentExtension  String?
  draftParentType  String?
  keyId                 Int?
  publicKey             PublicKey?        @relation(fields: [keyId], references: [id])
  parentMessage         Message?          @relation("DraftReplyToMessage", fields: [draftParentMessageId], references: [id])
  lastMessage           MessageStatus?    @relation("LastMessageForChatParticipant", fields: [lastMessageId], references: [id])
  chat                  Chat              @relation(fields: [chatId], references: [id])
  user                  User              @relation(fields: [userId], references: [id])
  groupParticipant      GroupParticipant?

  @@unique([chatId, userId])
}

model GroupParticipant {
  id          Int     @id 
  isAdmin     Boolean @default(false)
  canDownload Boolean @default(true)
  canDelete   Boolean @default(true)
  canPost     Boolean @default(true)
  canEdit     Boolean @default(true)
  chatParticipant          ChatParticipant @relation(fields:[id],references: [id])
}

model ChannelParticipant {
  id          Int     @id @default(autoincrement())
  channelId   Int
  userId      Int
  isAdmin     Boolean @default(false)
  isMuted     Boolean @default(false)
  canDownload Boolean @default(true)
  canComment  Boolean @default(true)
  Channel     Channel @relation(fields: [channelId], references: [chatId])
  participant User    @relation(fields: [userId], references: [id])

  @@unique([channelId, userId])
}
